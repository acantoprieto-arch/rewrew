<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Clasificación</title>
<style>
  body {
    background-color: #000;
    font-family: Arial, sans-serif;
    color: #fff;
    margin: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }

  th, td {
    text-align: center;
    padding: 0 10px;
    height: 70px;
    vertical-align: middle;
  }

  th {
    font-weight: bold;
    border-bottom: 2px solid #555;
  }

  tr:nth-child(even) {
    background-color: #111;
  }

  tr:nth-child(odd) {
    background-color: #000;
  }

  tr:hover {
    background-color: #333;
  }

  .pos {
    background-color: #fff;
    color: #000;
    font-weight: bold;
  }

  .clase {
    background-color: #c00;
    color: #fff;
    display: inline-block;
    padding: 5px 10px;
    border-radius: 4px;
  }

  .numero {
    background-color: #fff;
    color: #000;
    display: inline-block;
    padding: 5px 10px;
    border-radius: 4px;
    font-weight: bold;
  }

  .piloto {
    font-weight: bold;
  }

  .pts {
    font-weight: bold;
  }

  .img-cell img {
    height: 32px;
    width: auto;
  }
</style>
</head>
<body>

<table id="clasificacion">
  <thead>
    <tr>
      <th>Pos</th>
      <th>Clase</th>
      <th>Piloto</th>
      <th>#</th>
      <th>Equipo</th>
      <th>Coche</th>
      <th>Marca</th>
      <th>Espec</th>
      <th>Pen</th>
      <th>R1</th>
      <th>R2</th>
      <th>R3</th>
      <th>R4</th>
      <th>Pts</th>
      <th>Gap</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRKjM6EtJwKRvQ-QFOSqjaC-_eiv0KhHwHlvJEx4PEs4z3p1Fytv2-28zS_yfwcWBiTE11VZNnWEfUP/pub?gid=373798981&single=true&output=csv";

  fetch(CSV_URL)
    .then(res => res.text())
    .then(csvText => {
      const lines = csvText.split("\n").filter(line => line.trim() !== "");
      const headers = lines.shift().split(",");
      const tbody = document.querySelector("#clasificacion tbody");

      lines.forEach((line, index) => {
        const values = line.split(",");

        // Calcular Gap desplazado (fila 1 vacía)
        let gap = "";
        if(index > 0){
          const ptsActual = parseInt(values[13]) || 0;
          const ptsAnterior = parseInt(lines[index-1].split(",")[13]) || 0;
          gap = ptsAnterior - ptsActual;
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="pos">${values[0]}</td>
          <td><span class="clase">GT3</span></td>
          <td class="piloto">${values[2]}</td>
          <td class="numero">${values[3]}</td>
          <td>${values[4]}</td>
          <td class="img-cell">${values[5] ? `<img src="${values[5]}" alt="Coche">` : ""}</td>
          <td class="img-cell">${values[6] ? `<img src="${values[6]}" alt="Marca">` : "<img src='https://cdn.thesimgrid.com/meolcsgh9xums1wa7amcchkqdbmo' alt='Marca'>"} </td>
          <td>${values[7]}</td>
          <td>${values[8]}</td>
          <td>${values[9]}</td>
          <td>${values[10]}</td>
          <td>${values[11]}</td>
          <td>${values[12]}</td>
          <td class="pts">${values[13]}</td>
          <td>${gap}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => console.error(err));
</script>

</body>
</html>
